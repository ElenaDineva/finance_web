{% extends "layout.html" %}

{% block title %}
    Register
{% endblock %}

{% block main %}

    <form action="/register" id="register-form" method="post">
        <div class="form-group">
            <input autocomplete="off" autofocus class="form-control" name="username" placeholder="Username" type="text" id="username">
        </div>
        <div class="form-group">
            <input class="form-control" name="password" placeholder="Password" type="password" required="required">
        </div>
        <div class="form-group">
            <input class="form-control" name="confirmation" placeholder="Confirm Password" type="password" required="required">
        </div>
        <button class="btn btn-primary" id="submit-button" type="submit">Register Now</button>
    </form>

    <script>
          $('#submit-button').on('click', function(e) {
                console.log('adasdasdasdas');

                e.preventDefault();

                $.ajax({
                  method: "GET",
                  url: "/check",
                  data: { username: $('#username').val() },
                  error: function(error) {
                      alert('Some error ', error);
                  },
                  success: function(response) {
                     if(response) {
                         $('#register-form').submit();

                         return;
                     }

                     alert('There is already such a user!');
                  }
                })
            });

    </script>

{% endblock %}
